{% extends 'base.html' %}

{% block title %}Guía #{{ guia.id }} - HOKO{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h1 class="h4 mb-0">Guía de Envío #{{ guia.id }}</h1>
        </div>
        <div class="card-body">
            <div class="row mb-4">
                <div class="col-md-6">
                    <h4>Información del Cliente</h4>
                    <p><strong>Nombre:</strong> {{ guia.cliente_nombre }}</p>
                    <p><strong>Teléfono:</strong> {{ guia.cliente_telefono }}</p>
                    <p><strong>Ciudad:</strong> {{ guia.get_cliente_ciudad_display }}</p>
                    <p><strong>Dirección:</strong> {{ guia.cliente_direccion|linebreaksbr }}</p>
                    {% if guia.cliente_direccion2 %}
                    <p><strong>Dirección secundaria:</strong> {{ guia.cliente_direccion2|linebreaksbr }}</p>
                    {% endif %}
                </div>
                <div class="col-md-6">
                    <h4>Detalles del Envío</h4>
                    <p><strong>Código de seguimiento:</strong> {{ guia.codigo_seguimiento }}</p>
                    <p><strong>Estado:</strong> <span class="badge bg-info text-dark">{{ guia.get_estado_display }}</span></p>
                    <p><strong>Fecha creación:</strong> {{ guia.fecha_creacion|date:"d/m/Y H:i:s" }}</p>
                    <p><strong>Última actualización:</strong> {{ guia.fecha_actualizacion|date:"d/m/Y H:i:s" }}</p>
                     {% if guia.observaciones %}
                        <p><strong>Observaciones:</strong> {{ guia.observaciones|linebreaksbr }}</p>
                    {% endif %}
                </div>
            </div>

            {% if guia.producto %}
            <hr>
            <h4>Producto Principal</h4>
             <table class="table table-sm table-bordered">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Precio Unitario</th>
                        <th>Cantidad</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            {% if guia.producto.imagen %}
                                <img src="{{ guia.producto.imagen.url }}" alt="{{ guia.producto.nombre }}" class="img-thumbnail mr-2" style="width: 50px; height: 50px; object-fit: contain;">
                            {% endif %}
                            {{ guia.producto.nombre }}
                        </td>
                        <td>${{ guia.producto.precio|floatformat:2 }}</td>
                        <td>{{ guia.cantidad }}</td>
                        <td>${{ guia.producto.precio|stringformat:".2f"|add:0|default:0.00|floatformat:2 }}</td>
                    </tr>
                </tbody>
            </table>
            {% endif %}


            {% if guia.items_guia.all %}
                <hr>
                <h4>Productos Detallados en la Guía (Tabla)</h4>
                {% if guia.contenido_resumen %}
                    <p class="text-muted"><small>Resumen: {{ guia.contenido_resumen }}</small></p>
                {% endif %}
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Imagen</th>
                                <th>Producto</th>
                                <th>Precio Unitario (Guía)</th>
                                <th>Cantidad</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in guia.items_guia.all %}
                            <tr>
                                <td>
                                    {% if item.producto.imagen %}
                                        <img src="{{ item.producto.imagen.url }}" alt="{{ item.producto.nombre }}" class="img-thumbnail" style="width: 60px; height: 60px; object-fit: contain;">
                                    {% else %}
                                        <img src="https://via.placeholder.com/60" alt="Sin imagen" class="img-thumbnail">
                                    {% endif %}
                                </td>
                                <td>{{ item.producto.nombre }}</td>
                                <td>${{ item.precio_unitario_en_guia|floatformat:2 }}</td>
                                <td>{{ item.cantidad }}</td>
                                <td>${{ item.subtotal|floatformat:2 }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr class="table-light">
                                <td colspan="4" class="text-end"><strong>Total Guía (Tabla):</strong></td>
                                <td class="fw-bold">${{ guia.total_guia|floatformat:2 }}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            {% else %}
                 <hr>
                <p class="text-center text-muted">No hay productos detallados en la tabla para esta guía.</p>
            {% endif %}


            <div class="mt-4 d-flex justify-content-between">
                <a href="{% url 'listar_guias' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Volver al Listado
                </a>
                <a href="{% url 'editar_guia' guia.id %}" class="btn btn-warning">
                    <i class="fas fa-edit"></i> Editar Guía
                </a>
            </div>
        </div>
    </div>
</div>
<style>
    body { background-color: #f8f9fa; }
    .card-header h1 { font-size: 1.5rem; }
</style>
{% endblock %}